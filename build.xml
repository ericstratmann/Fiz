<?xml version="1.0" encoding="UTF-8"?>

<!--
This is the controlling file used by Ant to manage builds and tests
for the Fiz framework.
-->
<project default="javadoc" basedir=".">

    <target name="clean" description="Remove all generated files">
        <delete dir="out"/>
    </target>

    <target name="compile" description="Compile from source">
        <mkdir dir="${classdir}"/>
        <javac srcdir="src" destdir="${classdir}" classpathref="classpath" />
    </target>

    <target name="dist" description="Create a distribution"
            depends="compile, javadoc">
        <delete dir="${distdir}"/>

        <!-- Classes and libraries -->
        <mkdir dir="${distdir}/web/WEB-INF/lib"/>
        <jar destfile="${distdir}/web/WEB-INF/lib/fiz.jar"
                basedir="${classdir}"/>
        <copy todir="${distdir}/web/WEB-INF/lib">
            <fileset dir="${libdir}"/>
        </copy>
        <mkdir dir="${distdir}/web/WEB-INF/classes"/>
        <copy todir="${distdir}/web/WEB-INF/classes"
                file="src/log4j.properties"/>

        <!-- Other run-time files needed by Fiz -->
        <mkdir dir="${distdir}/web/WEB-INF/fiz/config"/>
        <copy todir="${distdir}/web/WEB-INF/fiz/config">
            <fileset dir="web/WEB-INF/fiz/config"/>
        </copy>
        <mkdir dir="${distdir}/web/WEB-INF/fiz/css"/>
        <copy todir="${distdir}/web/WEB-INF/fiz/css">
            <fileset dir="web/WEB-INF/fiz/css"/>
        </copy>
        <mkdir dir="${distdir}/web/fizlib"/>
        <copy todir="${distdir}/web/fizlib">
            <fileset dir="javascript/fizlib"/>
        </copy>
        <mkdir dir="${distdir}/web/WEB-INF/demo"/>
        <copy todir="${distdir}/web/WEB-INF/demo">
            <fileset dir="web/WEB-INF/demo"/>
        </copy>
        <copy todir="${distdir}/web/WEB-INF" file="web/WEB-INF/web.xml"/>

        <!-- Documentation -->
        <mkdir dir="${distdir}/javadoc"/>
        <copy todir="${distdir}/javadoc">
            <fileset dir="../doc"/>
        </copy>

        <!-- Source files -->
        <mkdir dir="${distdir}/src"/>
        <copy todir="${distdir}/src/javascript">
            <fileset dir="javascript" />
        </copy>
        <copy todir="${distdir}/src/src">
            <fileset dir="src" />
        </copy>
        <copy todir="${distdir}/src/test">
            <fileset dir="test" />
        </copy>
        <copy todir="${distdir}/src/web">
            <fileset dir="web" />
        </copy>
        <copy todir="${distdir}/src">
            <fileset dir="." includes="build.xml, Fiz.iml,
                    Fiz.ipr, Fiz.iws javadoc.css" />
        </copy>

        <!-- Create archives -->
        <delete dir="${distdir}/../fiz.zip"/>
        <zip destfile="${distdir}/../fiz.zip" basedir="${distdir}" />

    </target>

    <target name="javadoc" depends="compile">
        <javadoc sourcepath="src"
                 destdir="../doc"
                 public="true"
                 Windowtitle="Fiz documentation"
                 docletpath="${classdir}"
                 doclet="org.fiz.FizDoc">
            <classpath>
                <path refid="classpath"/>
                <pathelement location="C:/cygwin/usr/local/tools/i686_win32/jdk1.6.0_01/lib/tools.jar" />
            </classpath>
        </javadoc>
        <concat destfile="../doc/stylesheet.css" append="true">
            <filelist dir="." files="javadoc.css"/>
        </concat>
    </target>

    <!-- The directory in which distributions are created. -->
    <property name="distdir" value="../out/dist" />

    <!-- The directory containing Java libraries (.jar files). -->
    <property name="libdir" value="../lib" />

    <!-- The directory in which Java classes are compiled. -->
    <property name="classdir" value="../out/classes" />

    <path id="classpath">
        <pathelement location="${libdir}/servlet.jar"/>
        <pathelement location="${libdir}/log4j.jar" />
        <pathelement location="${libdir}/jyaml.jar" />
        <pathelement location="${libdir}/js.jar" />
    </path>
</project>